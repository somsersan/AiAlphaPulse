# Интеграция Telegram парсера

## Обзор

Telegram парсер успешно интегрирован в существующую систему RSS парсера. Теперь система автоматически парсит как RSS-ленты, так и Telegram каналы каждую минуту.

## Что было сделано

### 1. Модификация `telegram_parser.py`
- Добавлена интеграция с существующей базой данных PostgreSQL
- Создана функция `parse_and_save_telegram()` для сохранения постов в БД
- Добавлены функции `setup_database()` и `calculate_reading_stats()`
- Посты Telegram теперь сохраняются в ту же таблицу `articles`, что и RSS статьи

### 2. Обновление `main.py`
- Добавлен импорт `parse_and_save_telegram`
- Модифицирована функция `auto_parse_worker()` для включения Telegram парсинга
- Обновлены API эндпоинты:
  - `/parse` - парсинг RSS + Telegram
  - `/parse/rss` - только RSS
  - `/parse/telegram` - только Telegram
- Обновлено описание API

### 3. Структура данных
Telegram посты сохраняются в том же формате, что и RSS статьи:
- `title` - первые 255 символов поста
- `content` - полный текст поста
- `source` - название канала (например, @RBCNews)
- `category` - категории на основе ключевых слов
- `word_count` и `reading_time` - автоматически вычисляются

## Использование

### Автоматический парсинг
Система автоматически парсит все источники каждую минуту:
- RSS-ленты из `RSS_URLS`
- Telegram каналы из `CHANNELS`

### Ручной парсинг через API
```bash
# Парсинг всех источников
curl -X POST http://localhost:8000/parse

# Только RSS
curl -X POST http://localhost:8000/parse/rss

# Только Telegram
curl -X POST http://localhost:8000/parse/telegram
```

### Получение данных
```bash
# Последние статьи
curl http://localhost:8000/articles

# Статистика
curl http://localhost:8000/stats

# Статус парсинга
curl http://localhost:8000/status
```

## Конфигурация

### Telegram каналы
Список каналов находится в переменной `CHANNELS` в `telegram_parser.py`:
- Российские финансовые каналы (RBCNews, vedomosti, kommersant, etc.)
- Международные каналы (Bloomberg, TheEconomist, etc.)
- Криптовалютные каналы (CryptoMarkets, etc.)

### Ключевые слова для категоризации
Определены в переменной `KEYWORDS`:
- "акцизы" - табак, алкоголь, топливо
- "акции" - биржа, торговля, котировки
- "мировая экономика" - доллар, нефть, санкции

## Мониторинг

Логи парсинга показывают:
- Количество обработанных каналов
- Количество постов с каждого канала
- Ошибки и предупреждения
- Статистику добавленных записей

## Производительность

- Парсинг 65 Telegram каналов занимает ~10-15 секунд
- Система обрабатывает до 20 постов с каждого канала
- Автоматическое определение дубликатов по заголовку
- Асинхронная обработка для повышения скорости

## Запуск

```bash
# Активация виртуального окружения
source venv/bin/activate

# Запуск приложения
python main.py

# Или через Docker
./start.sh
```

Система готова к работе и будет автоматически собирать данные из всех источников каждую минуту.
