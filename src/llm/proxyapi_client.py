"""–ö–ª–∏–µ–Ω—Ç –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å ProxyAPI.ru (OpenRouter —á–µ—Ä–µ–∑ ProxyAPI)"""
import os
import requests
import json
from typing import Dict, List, Optional
from dotenv import load_dotenv

# –ó–∞–≥—Ä—É–∂–∞–µ–º –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –∏–∑ .env —Ñ–∞–π–ª–∞
load_dotenv()


class ProxyAPIClient:
    """–ö–ª–∏–µ–Ω—Ç –¥–ª—è ProxyAPI.ru (–ø–æ–¥–¥–µ—Ä–∂–∫–∞ OpenAI, Anthropic, OpenRouter)"""
    
    def __init__(self, api_key: str = None, model: str = None):
        self.api_key = api_key or os.getenv("PROXYAPI_KEY")
        if not self.api_key:
            raise ValueError("PROXYAPI_KEY –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω")
        
        initial_model = model or os.getenv("LLM_MODEL", "deepseek/deepseek-chat")
        
        # –û–ø—Ä–µ–¥–µ–ª—è–µ–º —ç–Ω–¥–ø–æ–∏–Ω—Ç –∏ —Ñ–æ—Ä–º–∞—Ç –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –º–æ–¥–µ–ª–∏
        self.base_url, self.api_format, self.model = self._get_api_config(initial_model)
        
    def _get_api_config(self, model: str):
        """–û–ø—Ä–µ–¥–µ–ª—è–µ—Ç —ç–Ω–¥–ø–æ–∏–Ω—Ç –∏ —Ñ–æ—Ä–º–∞—Ç API –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –º–æ–¥–µ–ª–∏. –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç (url, api_format, cleaned_model)"""
        print(f"\nüîß ProxyAPIClient._get_api_config:")
        print(f"   –í—Ö–æ–¥–Ω–∞—è –º–æ–¥–µ–ª—å: {model}")
        
        # –û—á–∏—â–∞–µ–º –∏–º—è –º–æ–¥–µ–ª–∏ –æ—Ç –ø—Ä–µ—Ñ–∏–∫—Å–æ–≤ –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞
        model_clean = model.replace('openai/', '').replace('anthropic/', '')
        print(f"   –û—á–∏—â–µ–Ω–Ω–∞—è –º–æ–¥–µ–ª—å: {model_clean}")
        
        # OpenAI –º–æ–¥–µ–ª–∏
        if model_clean.startswith('gpt-') or model.startswith('openai/'):
            # –£–±–∏—Ä–∞–µ–º –ø—Ä–µ—Ñ–∏–∫—Å –µ—Å–ª–∏ –µ—Å—Ç—å
            clean_model = model_clean if '/' in model else model
            print(f"   ‚úÖ –û–ø—Ä–µ–¥–µ–ª–µ–Ω —Ñ–æ—Ä–º–∞—Ç: OpenAI")
            print(f"   –§–∏–Ω–∞–ª—å–Ω–∞—è –º–æ–¥–µ–ª—å: {clean_model}")
            print(f"   URL: https://api.proxyapi.ru/openai/v1/chat/completions")
            return "https://api.proxyapi.ru/openai/v1/chat/completions", "openai", clean_model
        
        # Anthropic –º–æ–¥–µ–ª–∏ - –∏—Å–ø–æ–ª—å–∑—É–µ–º –ø—Ä—è–º–æ–π Anthropic API —ç–Ω–¥–ø–æ–∏–Ω—Ç ProxyAPI
        # –°–æ–≥–ª–∞—Å–Ω–æ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ ProxyAPI: https://proxyapi.ru/docs/anthropic-text-generation
        # –§–æ—Ä–º–∞—Ç –º–æ–¥–µ–ª–∏: claude-3-7-sonnet-20250219 (—Å –¥–µ—Ñ–∏—Å–∞–º–∏, –Ω–µ —Ç–æ—á–∫–∞–º–∏!)
        if model_clean.startswith('claude-') or model.startswith('anthropic/'):
            print(f"   ‚úÖ –û–ø—Ä–µ–¥–µ–ª–µ–Ω —Ñ–æ—Ä–º–∞—Ç: Anthropic (–ø—Ä—è–º–æ–π —ç–Ω–¥–ø–æ–∏–Ω—Ç)")
            print(f"   üìñ –°–æ–≥–ª–∞—Å–Ω–æ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ ProxyAPI, –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –º–æ–¥–µ–ª–∏ —Å –¥–µ—Ñ–∏—Å–∞–º–∏")
            
            # –î–ª—è –ø—Ä—è–º–æ–≥–æ Anthropic API –∏—Å–ø–æ–ª—å–∑—É–µ–º –∏–º—è –º–æ–¥–µ–ª–∏ –±–µ–∑ –ø—Ä–µ—Ñ–∏–∫—Å–∞ anthropic/
            # –í –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ ProxyAPI —É–∫–∞–∑–∞–Ω —Ñ–æ—Ä–º–∞—Ç —Å –î–ï–§–ò–°–ê–ú–ò: claude-3-7-sonnet-20250219
            if model.startswith('anthropic/'):
                # –£–±–∏—Ä–∞–µ–º –ø—Ä–µ—Ñ–∏–∫—Å
                clean_model = model.replace('anthropic/', '')
                # –ï—Å–ª–∏ –µ—Å—Ç—å —Ç–æ—á–∫–∞ –≤ –≤–µ—Ä—Å–∏–∏ (claude-3.5-sonnet), –∑–∞–º–µ–Ω—è–µ–º –Ω–∞ –¥–µ—Ñ–∏—Å (claude-3-5-sonnet)
                clean_model = clean_model.replace('.', '-')
                print(f"   –ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ –∏–∑ anthropic/ —Ñ–æ—Ä–º–∞—Ç–∞: {model} -> {clean_model}")
                # –°—É—Ñ—Ñ–∏–∫—Å –¥–∞—Ç—ã —É–∂–µ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å —Å–æ—Ö—Ä–∞–Ω–µ–Ω –ø–æ—Å–ª–µ –∑–∞–º–µ–Ω—ã —Ç–æ—á–µ–∫ –Ω–∞ –¥–µ—Ñ–∏—Å—ã
            else:
                # –ú–æ–¥–µ–ª—å —É–∂–µ –≤ —Ñ–æ—Ä–º–∞—Ç–µ claude-*, –∏—Å–ø–æ–ª—å–∑—É–µ–º –∫–∞–∫ –µ—Å—Ç—å
                # –ï—Å–ª–∏ –µ—Å—Ç—å —Ç–æ—á–∫–∞ –≤ –≤–µ—Ä—Å–∏–∏, –∑–∞–º–µ–Ω—è–µ–º –Ω–∞ –¥–µ—Ñ–∏—Å
                clean_model = model_clean.replace('.', '-')
                
                # –°–æ—Ö—Ä–∞–Ω—è–µ–º —Å—É—Ñ—Ñ–∏–∫—Å –¥–∞—Ç—ã –µ—Å–ª–∏ –æ–Ω –µ—Å—Ç—å
                date_suffix = None
                if '-202' in clean_model:
                    parts = clean_model.split('-202')
                    clean_model = parts[0]
                    date_suffix = '-202' + parts[1] if len(parts) > 1 else None
                    print(f"   –°–æ—Ö—Ä–∞–Ω–µ–Ω —Å—É—Ñ—Ñ–∏–∫—Å –¥–∞—Ç—ã: {date_suffix}")
                
                # –ù–æ—Ä–º–∞–ª–∏–∑—É–µ–º –±–∞–∑–æ–≤–æ–µ –∏–º—è –º–æ–¥–µ–ª–∏
                if 'claude-3-5-haiku' in clean_model:
                    clean_model = 'claude-3-5-haiku'
                elif 'claude-3-5-sonnet' in clean_model:
                    clean_model = 'claude-3-5-sonnet'
                elif 'claude-3-opus' in clean_model:
                    clean_model = 'claude-3-opus'
                elif 'claude-3-haiku' in clean_model:
                    clean_model = 'claude-3-haiku'
                elif 'claude-3-sonnet' in clean_model:
                    clean_model = 'claude-3-sonnet'
                
                # –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Å—É—Ñ—Ñ–∏–∫—Å –µ—Å–ª–∏ –æ–Ω –±—ã–ª
                if date_suffix:
                    clean_model = clean_model + date_suffix
                
                print(f"   –ù–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–∞—è –º–æ–¥–µ–ª—å: {clean_model}")
            
            # –°–æ–≥–ª–∞—Å–Ω–æ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ ProxyAPI, –º–æ–¥–µ–ª–∏ —Ç—Ä–µ–±—É—é—Ç –ø–æ–ª–Ω—ã–µ –Ω–∞–∑–≤–∞–Ω–∏—è —Å —Å—É—Ñ—Ñ–∏–∫—Å–∞–º–∏ –¥–∞—Ç—ã
            # https://proxyapi.ru/docs/anthropic-models
            # –ê–∫—Ç—É–∞–ª—å–Ω—ã–π —Å–ø–∏—Å–æ–∫ –º–æ–¥–µ–ª–µ–π –Ω–∞ –Ω–æ—è–±—Ä—å 2025:
            # - claude-3-7-sonnet-20250219
            # - claude-3-5-sonnet-20241022 (–º–æ–∂–µ—Ç –±—ã—Ç—å —É—Å—Ç–∞—Ä–µ–≤—à–µ–π)
            # - claude-sonnet-4-5-20250929
            # - claude-opus-4-1-20250805
            # - claude-haiku-4-5-20251001
            
            # –ú–∞–ø–ø–∏–Ω–≥ —É—Å—Ç–∞—Ä–µ–≤—à–∏—Ö –º–æ–¥–µ–ª–µ–π –Ω–∞ –∞–∫—Ç—É–∞–ª—å–Ω—ã–µ –≤–µ—Ä—Å–∏–∏
            outdated_model_mapping = {
                'claude-3-5-sonnet-20241022': 'claude-3-7-sonnet-20250219',  # –£—Å—Ç–∞—Ä–µ–≤—à–∞—è -> –Ω–æ–≤–∞—è
            }
            
            # –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–µ —è–≤–ª—è–µ—Ç—Å—è –ª–∏ –º–æ–¥–µ–ª—å —É—Å—Ç–∞—Ä–µ–≤—à–µ–π
            if clean_model in outdated_model_mapping:
                print(f"   ‚ö†Ô∏è –û–±–Ω–∞—Ä—É–∂–µ–Ω–∞ —É—Å—Ç–∞—Ä–µ–≤—à–∞—è –º–æ–¥–µ–ª—å: {clean_model}")
                clean_model = outdated_model_mapping[clean_model]
                print(f"   üîÑ –û–±–Ω–æ–≤–ª–µ–Ω–∞ –Ω–∞ –∞–∫—Ç—É–∞–ª—å–Ω—É—é –≤–µ—Ä—Å–∏—é: {clean_model}")
            elif '-202' in clean_model:
                print(f"   ‚úÖ –°—É—Ñ—Ñ–∏–∫—Å –¥–∞—Ç—ã —É–∂–µ –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É–µ—Ç: {clean_model}")
            else:
                # –ú–∞–ø–ø–∏–Ω–≥ –º–æ–¥–µ–ª–µ–π –Ω–∞ –∞–∫—Ç—É–∞–ª—å–Ω—ã–µ –≤–µ—Ä—Å–∏–∏ —Å fallback –Ω–∞ –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤—ã
                # –ï—Å–ª–∏ —Å—Ç–∞—Ä–∞—è –º–æ–¥–µ–ª—å –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞, –∏—Å–ø–æ–ª—å–∑—É–µ–º –±–æ–ª–µ–µ –Ω–æ–≤—É—é
                model_mapping = {
                    'claude-3-5-haiku': 'claude-3-5-haiku-20241022',  # –û—Å–Ω–æ–≤–Ω–æ–π –≤–∞—Ä–∏–∞–Ω—Ç
                    'claude-3-5-sonnet': 'claude-3-7-sonnet-20250219',  # –ò—Å–ø–æ–ª—å–∑—É–µ–º –±–æ–ª–µ–µ –Ω–æ–≤—É—é –≤–µ—Ä—Å–∏—é –∫–∞–∫ fallback
                    'claude-3-opus': 'claude-opus-4-1-20250805',  # –ò—Å–ø–æ–ª—å–∑—É–µ–º –Ω–æ–≤—É—é –≤–µ—Ä—Å–∏—é Opus 4
                    'claude-3-haiku': 'claude-3-5-haiku-20241022',  # –û–±–Ω–æ–≤–ª—è–µ–º –Ω–∞ 3.5
                    'claude-3-sonnet': 'claude-sonnet-4-5-20250929'  # –ò—Å–ø–æ–ª—å–∑—É–µ–º –Ω–æ–≤—É—é –≤–µ—Ä—Å–∏—é Sonnet 4
                }
                
                # –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ —Ç–æ—á–Ω–æ–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ
                if clean_model in model_mapping:
                    original_model = clean_model
                    clean_model = model_mapping[clean_model]
                    print(f"   üîÑ –ú–∞–ø–ø–∏–Ω–≥ –º–æ–¥–µ–ª–∏: {original_model} -> {clean_model}")
                    print(f"   üí° –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∞–∫—Ç—É–∞–ª—å–Ω–∞—è –≤–µ—Ä—Å–∏—è –º–æ–¥–µ–ª–∏")
                else:
                    # –î–ª—è –¥—Ä—É–≥–∏—Ö –º–æ–¥–µ–ª–µ–π –ø—Ä–æ–±—É–µ–º –Ω–∞–π—Ç–∏ –ø–æ—Ö–æ–∂—É—é –∏–ª–∏ –æ—Å—Ç–∞–≤–ª—è–µ–º –∫–∞–∫ –µ—Å—Ç—å
                    print(f"   ‚ö†Ô∏è –ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –º–æ–¥–µ–ª—å –±–µ–∑ —Å—É—Ñ—Ñ–∏–∫—Å–∞: {clean_model}")
                    print(f"   üí° –ü–æ–ø—Ä–æ–±—É–µ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∫–∞–∫ –µ—Å—Ç—å, –Ω–æ –≤–æ–∑–º–æ–∂–Ω–∞ –æ—à–∏–±–∫–∞")
            
            print(f"   ‚úÖ –§–∏–Ω–∞–ª—å–Ω–∞—è –º–æ–¥–µ–ª—å –¥–ª—è API: {clean_model}")
            print(f"   üåê URL: https://api.proxyapi.ru/anthropic/v1/messages")
            print(f"   üìñ –°–æ–≥–ª–∞—Å–Ω–æ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ ProxyAPI, –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –ø–æ–ª–Ω—ã–µ –Ω–∞–∑–≤–∞–Ω–∏—è —Å –¥–∞—Ç–∞–º–∏")
            return "https://api.proxyapi.ru/anthropic/v1/messages", "anthropic", clean_model
        
        # –í—Å–µ –æ—Å—Ç–∞–ª—å–Ω—ã–µ —á–µ—Ä–µ–∑ OpenRouter
        print(f"   ‚úÖ –û–ø—Ä–µ–¥–µ–ª–µ–Ω —Ñ–æ—Ä–º–∞—Ç: OpenRouter")
        print(f"   –§–∏–Ω–∞–ª—å–Ω–∞—è –º–æ–¥–µ–ª—å: {model}")
        print(f"   URL: https://api.proxyapi.ru/openrouter/v1/chat/completions")
        return "https://api.proxyapi.ru/openrouter/v1/chat/completions", "openrouter", model
        
    def analyze_news(self, headline: str, content: str) -> Dict:
        """
        –ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç –Ω–æ–≤–æ—Å—Ç—å –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç hotness, —Ç–∏–∫–µ—Ä—ã –∏ –∞–Ω–≥–ª–∏–π—Å–∫—É—é –≤–µ—Ä—Å–∏—é –Ω–æ–≤–æ—Å—Ç–∏
        
        Returns:
            {
                'hotness': float (0-1),
                'tickers': List[str],
                'reasoning': str,
                'headline_en': str,
                'content_en': str
            }
        """
        
        prompt = f"""–¢—ã - —Å—Ç—Ä–æ–≥–∏–π —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã–π –∞–Ω–∞–ª–∏—Ç–∏–∫. –û—Ü–µ–Ω–∏ –Ω–æ–≤–æ—Å—Ç—å –ø–æ –º–Ω–æ–≥–æ—Ñ–∞–∫—Ç–æ—Ä–Ω–æ–π —Ñ–æ—Ä–º—É–ª–µ hotness –¥–ª—è —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã—Ö —Ä—ã–Ω–∫–æ–≤.

–ó–ê–ì–û–õ–û–í–û–ö: {headline}
–¢–ï–ö–°–¢: {content[:2000]}

–§–û–†–ú–£–õ–ê HOTNESS (0.00 - 1.00):
hotness = scale √ó market_impact + urgency + novelty + materiality

–ì–î–ï –ö–ê–ñ–î–´–ô –ö–û–ú–ü–û–ù–ï–ù–¢:

1) SCALE (–º–∞—Å—à—Ç–∞–± —Å–æ–±—ã—Ç–∏—è) ‚Äî –≤–µ—Å 0-0.30:
   ‚Ä¢ 0.30: –ì–ª–æ–±–∞–ª—å–Ω–æ–µ (–º–∏—Ä–æ–≤–∞—è –≤–æ–π–Ω–∞, –∫—Ä–∞—Ö G7 —ç–∫–æ–Ω–æ–º–∏–∫–∏, –¥–µ—Ñ–æ–ª—Ç –°–®–ê/–ö–∏—Ç–∞—è)
   ‚Ä¢ 0.20-0.25: –ù–∞—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–µ (—Ä–µ—à–µ–Ω–∏–µ –¶–ë/–§–†–° –ø–æ —Å—Ç–∞–≤–∫–µ, —Å–º–µ–Ω–∞ –ø—Ä–µ–∑–∏–¥–µ–Ω—Ç–∞, –∫—Ä—É–ø–Ω–µ–π—à–∏–µ IPO >$10B)
   ‚Ä¢ 0.10-0.15: –†–µ–≥–∏–æ–Ω–∞–ª—å–Ω–æ–µ/–°–µ–∫—Ç–æ—Ä–Ω–æ–µ (–æ—Ç—Ä–∞—Å–ª–µ–≤–æ–µ —Ä–µ–≥—É–ª–∏—Ä–æ–≤–∞–Ω–∏–µ, —Å–ª–∏—è–Ω–∏–µ –∫—Ä—É–ø–Ω—ã—Ö –∫–æ–º–ø–∞–Ω–∏–π)
   ‚Ä¢ 0.05-0.10: –ö–æ—Ä–ø–æ—Ä–∞—Ç–∏–≤–Ω–æ–µ (–∫–≤–∞—Ä—Ç–∞–ª—å–Ω—ã–µ –æ—Ç—á—ë—Ç—ã —Ç–æ–ø-100, M&A —Å—Ä–µ–¥–Ω–∏—Ö –∫–æ–º–ø–∞–Ω–∏–π)
   ‚Ä¢ 0.00-0.05: –õ–æ–∫–∞–ª—å–Ω–æ–µ/–Ω–µ–∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ–µ

2) MARKET_IMPACT (–ø—Ä—è–º–æ–µ –≤–ª–∏—è–Ω–∏–µ –Ω–∞ —Ä—ã–Ω–∫–∏) ‚Äî –≤–µ—Å 0-0.30:
   ‚Ä¢ 0.30: –ù–µ–º–µ–¥–ª–µ–Ω–Ω–æ–µ (—Å–∞–Ω–∫—Ü–∏–∏ –Ω–∞ —Ü–µ–ª—É—é –æ—Ç—Ä–∞—Å–ª—å, –¥–µ—Ñ–æ–ª—Ç, –±–∞–Ω–∫—Ä–æ—Ç—Å—Ç–≤–æ Fortune 500)
   ‚Ä¢ 0.20-0.25: –°—Ä–µ–¥–Ω–µ—Å—Ä–æ—á–Ω–æ–µ –ø—Ä—è–º–æ–µ (–∏–∑–º–µ–Ω–µ–Ω–∏–µ —Å—Ç–∞–≤–æ–∫, –Ω–æ–≤—ã–µ –Ω–∞–ª–æ–≥–∏, —Ç–∞—Ä–∏—Ñ—ã)
   ‚Ä¢ 0.10-0.15: –ö–æ—Å–≤–µ–Ω–Ω–æ–µ (—Ä–µ–≥—É–ª—è—Ç–æ—Ä–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è, –æ—Ç—Ä–∞—Å–ª–µ–≤—ã–µ —Ç—Ä–µ–Ω–¥—ã, –ø—Ä–æ–≥–Ω–æ–∑—ã –∞–Ω–∞–ª–∏—Ç–∏–∫–æ–≤)
   ‚Ä¢ 0.05-0.10: –°–ª–∞–±–æ–µ –∫–æ—Å–≤–µ–Ω–Ω–æ–µ (–æ–±—â–∏–µ –º–∞–∫—Ä–æ-–Ω–æ–≤–æ—Å—Ç–∏, –ø–ª–∞–Ω—ã –±–µ–∑ –¥–µ—Ç–∞–ª–µ–π)
   ‚Ä¢ 0.00-0.05: –ú–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ/–Ω–µ—Ç

3) URGENCY (—Å—Ä–æ—á–Ω–æ—Å—Ç—å —Ä–µ–∞–∫—Ü–∏–∏) ‚Äî –≤–µ—Å 0-0.20:
   ‚Ä¢ 0.20: –¢—Ä–µ–±—É–µ—Ç –ù–ï–ú–ï–î–õ–ï–ù–ù–û–ô —Ä–µ–∞–∫—Ü–∏–∏ (circuit breaker, halt —Ç–æ—Ä–≥–æ–≤, —ç–∫—Å—Ç—Ä–µ–Ω–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è)
   ‚Ä¢ 0.15: –í–∞–∂–Ω–æ –≤ –±–ª–∏–∂–∞–π—à–∏–µ —á–∞—Å—ã (breaking news —Å —Ü–µ–Ω–æ–≤—ã–º —ç—Ñ—Ñ–µ–∫—Ç–æ–º)
   ‚Ä¢ 0.10: –ê–∫—Ç—É–∞–ª—å–Ω–æ —Å–µ–≥–æ–¥–Ω—è (—Å–≤–µ–∂–∏–µ –¥–∞–Ω–Ω—ã–µ, –≤–∞–∂–Ω—ã–µ –∑–∞—è–≤–ª–µ–Ω–∏—è)
   ‚Ä¢ 0.05: –í —Ç–µ—á–µ–Ω–∏–µ –Ω–µ–¥–µ–ª–∏ (–ø–ª–∞–Ω–æ–≤—ã–µ —Å–æ–±—ã—Ç–∏—è, –∞–Ω–æ–Ω—Å—ã)
   ‚Ä¢ 0.00: –ù–µ —Å—Ä–æ—á–Ω–æ (–∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏–µ –æ–±–∑–æ—Ä—ã, –¥–æ–ª–≥–æ—Å—Ä–æ—á–Ω—ã–µ –ø–ª–∞–Ω—ã)

4) NOVELTY (–Ω–æ–≤–∏–∑–Ω–∞/—É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç—å) ‚Äî –≤–µ—Å 0-0.20:
   ‚Ä¢ 0.20: –ë–µ—Å–ø—Ä–µ—Ü–µ–¥–µ–Ω—Ç–Ω–æ–µ (–ø–µ—Ä–≤–æ–µ –≤ –∏—Å—Ç–æ—Ä–∏–∏, —Ä–µ–≤–æ–ª—é—Ü–∏–æ–Ω–Ω–æ–µ)
   ‚Ä¢ 0.15: –†–µ–¥–∫–æ–µ (—Ä–∞–∑ –≤ 5+ –ª–µ—Ç: –∫—Ä–∏–∑–∏—Å—ã, –º–µ–≥–∞-—Å–¥–µ–ª–∫–∏)
   ‚Ä¢ 0.10: –ù–µ—á–∞—Å—Ç–æ–µ (—Ä–∞–∑ –≤ –≥–æ–¥: –∫—Ä—É–ø–Ω—ã–µ IPO, —Å–º–µ–Ω–∞ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–∞ –¶–ë)
   ‚Ä¢ 0.05: –ü–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–æ–µ (–µ–∂–µ–∫–≤–∞—Ä—Ç–∞–ª—å–Ω–æ: –æ—Ç—á—ë—Ç—ã, –¥–∏–≤–∏–¥–µ–Ω–¥—ã)
   ‚Ä¢ 0.00: –†—É—Ç–∏–Ω–Ω–æ–µ (–µ–∂–µ–¥–Ω–µ–≤–Ω—ã–µ –Ω–æ–≤–æ—Å—Ç–∏)

5) MATERIALITY (–º–∞—Ç–µ—Ä–∏–∞–ª—å–Ω–æ—Å—Ç—å/–∫–æ–Ω–∫—Ä–µ—Ç–∏–∫–∞ –∞–∫—Ç–∏–≤–æ–≤) ‚Äî –≤–µ—Å 0-0.10:
   ‚Ä¢ 0.10: –ù–∞–∑–≤–∞–Ω—ã –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ –∫–æ–º–ø–∞–Ω–∏–∏/—Ç–∏–∫–µ—Ä—ã —Å —Ü–∏—Ñ—Ä–∞–º–∏ (–≤—ã—Ä—É—á–∫–∞, —Ü–µ–Ω—ã, –æ–±—ä—ë–º—ã)
   ‚Ä¢ 0.07: –ù–∞–∑–≤–∞–Ω—ã –∫–æ–º–ø–∞–Ω–∏–∏ –±–µ–∑ —Ü–∏—Ñ—Ä –∏–ª–∏ —Å–µ–∫—Ç–æ—Ä —Å —Ü–∏—Ñ—Ä–∞–º–∏
   ‚Ä¢ 0.05: –û–±—â–∏–π —Å–µ–∫—Ç–æ—Ä/—Ä—ã–Ω–æ–∫ –±–µ–∑ –¥–µ—Ç–∞–ª–µ–π
   ‚Ä¢ 0.02: –£–ø–æ–º–∏–Ω–∞—é—Ç—Å—è —Ä—ã–Ω–∫–∏ –∫–æ—Å–≤–µ–Ω–Ω–æ
   ‚Ä¢ 0.00: –ù–µ—Ç —É–ø–æ–º–∏–Ω–∞–Ω–∏—è –∞–∫—Ç–∏–≤–æ–≤

–§–ò–õ–¨–¢–† –†–ï–õ–ï–í–ê–ù–¢–ù–û–°–¢–ò:
–ï—Å–ª–∏ –Ω–æ–≤–æ—Å—Ç—å –ù–ï –æ —Ñ–∏–Ω–∞–Ω—Å–∞—Ö/—ç–∫–æ–Ω–æ–º–∏–∫–µ/—Ä—ã–Ω–∫–∞—Ö (—Å–ø–æ—Ä—Ç, –ø–æ–≥–æ–¥–∞, –∫—Ä–∏–º–∏–Ω–∞–ª, —Ä–∞–∑–≤–ª–µ—á–µ–Ω–∏—è, –±—ã—Ç–æ–≤–æ–µ), —É—Å—Ç–∞–Ω–æ–≤–∏:
‚Ä¢ hotness = 0.00‚Äì0.10 (—Å—É–º–º–∞ –≤—Å–µ—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –±–ª–∏–∑–∫–∞ –∫ –Ω—É–ª—é)
‚Ä¢ tickers = []
‚Ä¢ reasoning = "–ù–µ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ –¥–ª—è —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã—Ö —Ä—ã–Ω–∫–æ–≤"

–ò–ó–í–õ–ï–ß–ï–ù–ò–ï –¢–ò–ö–ï–†–û–í:
–ù–∞–π–¥–∏ –í–°–ï —É–ø–æ–º—è–Ω—É—Ç—ã–µ —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã:
‚Ä¢ –ê–∫—Ü–∏–∏: AAPL, TSLA, SBER, GAZP, NVDA
‚Ä¢ –ö—Ä–∏–ø—Ç–æ–≤–∞–ª—é—Ç—ã: BTC, ETH, SOL
‚Ä¢ –ò–Ω–¥–µ–∫—Å—ã: S&P500, MOEX, NASDAQ, Dow
‚Ä¢ –í–∞–ª—é—Ç—ã/–°—Ç—Ä–∞–Ω—ã: USD, EUR, RU, USA, CN, EU
‚Ä¢ –°—ã—Ä—å—ë: GOLD, OIL, GAS

–ö–†–ò–¢–ò–ß–ï–°–ö–ò –í–ê–ñ–ù–û: –î–í–£–•–≠–¢–ê–ü–ù–ê–Ø –°–ò–°–¢–ï–ú–ê –û–¶–ï–ù–ö–ò –î–õ–Ø –ì–ê–†–ê–ù–¢–ò–†–û–í–ê–ù–ù–û–ô –£–ù–ò–ö–ê–õ–¨–ù–û–°–¢–ò:

–®–ê–ì 1: –û–¶–ï–ù–ö–ê –ë–ê–ó–û–í–û–ô –ö–ê–¢–ï–ì–û–†–ò–ò (1-9 –ø–æ —à–∫–∞–ª–µ –≤–∞–∂–Ω–æ—Å—Ç–∏)
–û—Ü–µ–Ω–∏ –Ω–æ–≤–æ—Å—Ç—å –ø–æ –±–∞–∑–æ–≤–æ–π —à–∫–∞–ª–µ –æ—Ç 1 –¥–æ 9:
‚Ä¢ 1-2: –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –≤–∞–∂–Ω–æ—Å—Ç—å (–ª–æ–∫–∞–ª—å–Ω—ã–µ –Ω–æ–≤–æ—Å—Ç–∏, –Ω–µ—Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã–µ)
‚Ä¢ 3-4: –ù–∏–∑–∫–∞—è –≤–∞–∂–Ω–æ—Å—Ç—å (–ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏–µ –æ—Ç—á—ë—Ç—ã, –º–∞—Ä–∫–µ—Ç–∏–Ω–≥–æ–≤—ã–µ –∞–∫—Ü–∏–∏)
‚Ä¢ 5-6: –°—Ä–µ–¥–Ω—è—è –≤–∞–∂–Ω–æ—Å—Ç—å (—Ä–µ–≥–∏–æ–Ω–∞–ª—å–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è, –∫–æ—Ä–ø–æ—Ä–∞—Ç–∏–≤–Ω—ã–µ –Ω–æ–≤–æ—Å—Ç–∏)
‚Ä¢ 7-8: –í—ã—Å–æ–∫–∞—è –≤–∞–∂–Ω–æ—Å—Ç—å (–Ω–∞—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è, –∫—Ä—É–ø–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è)
‚Ä¢ 9: –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –≤–∞–∂–Ω–æ—Å—Ç—å (–≥–ª–æ–±–∞–ª—å–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è, –¥–µ—Ñ–æ–ª—Ç—ã, –∫—Ä–∏–∑–∏—Å—ã)

–®–ê–ì 2: –î–û–ë–ê–í–õ–ï–ù–ò–ï –°–õ–£–ß–ê–ô–ù–´–• –¶–ò–§–† –î–õ–Ø –£–ù–ò–ö–ê–õ–¨–ù–û–°–¢–ò
–ü–æ—Å–ª–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –±–∞–∑–æ–≤–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ (1-9), –í–°–ï–ì–î–ê –¥–æ–±–∞–≤–ª—è–π —Å–ª—É—á–∞–π–Ω—ã–µ –¥–≤–µ —Ü–∏—Ñ—Ä—ã (–æ—Ç 00 –¥–æ 99) –∏ –¥–µ–ª–∏ –Ω–∞ 1000.

–§–û–†–ú–£–õ–ê: hotness = (–±–∞–∑–æ–≤–∞—è_–∫–∞—Ç–µ–≥–æ—Ä–∏—è √ó 100 + —Å–ª—É—á–∞–π–Ω—ã–µ_–¥–≤–µ_—Ü–∏—Ñ—Ä—ã) / 1000

–ü–†–ò–ú–ï–†–´ –ü–†–ê–í–ò–õ–¨–ù–û–ì–û –†–ê–°–ß–ï–¢–ê:
‚Ä¢ –ù–æ–≤–æ—Å—Ç—å –æ—Ü–µ–Ω–∏–≤–∞–µ—Ç—Å—è –∫–∞–∫ 2/10 –≤–∞–∂–Ω–æ—Å—Ç–∏ ‚Üí –±–∞–∑–æ–≤–∞—è –∫–∞—Ç–µ–≥–æ—Ä–∏—è = 2
  ‚Üí –î–æ–±–∞–≤–ª—è–µ–º —Å–ª—É—á–∞–π–Ω—ã–µ —Ü–∏—Ñ—Ä—ã, –Ω–∞–ø—Ä–∏–º–µ—Ä 91 ‚Üí hotness = (2√ó100 + 91) / 1000 = 0.291
‚Ä¢ –ù–æ–≤–æ—Å—Ç—å –æ—Ü–µ–Ω–∏–≤–∞–µ—Ç—Å—è –∫–∞–∫ 2/10 –≤–∞–∂–Ω–æ—Å—Ç–∏ ‚Üí –±–∞–∑–æ–≤–∞—è –∫–∞—Ç–µ–≥–æ—Ä–∏—è = 2
  ‚Üí –î–æ–±–∞–≤–ª—è–µ–º –î–†–£–ì–ò–ï —Å–ª—É—á–∞–π–Ω—ã–µ —Ü–∏—Ñ—Ä—ã, –Ω–∞–ø—Ä–∏–º–µ—Ä 47 ‚Üí hotness = (2√ó100 + 47) / 1000 = 0.247
‚Ä¢ –ù–æ–≤–æ—Å—Ç—å –æ—Ü–µ–Ω–∏–≤–∞–µ—Ç—Å—è –∫–∞–∫ 3/10 –≤–∞–∂–Ω–æ—Å—Ç–∏ ‚Üí –±–∞–∑–æ–≤–∞—è –∫–∞—Ç–µ–≥–æ—Ä–∏—è = 3
  ‚Üí –î–æ–±–∞–≤–ª—è–µ–º —Å–ª—É—á–∞–π–Ω—ã–µ —Ü–∏—Ñ—Ä—ã, –Ω–∞–ø—Ä–∏–º–µ—Ä 56 ‚Üí hotness = (3√ó100 + 56) / 1000 = 0.356
‚Ä¢ –ù–æ–≤–æ—Å—Ç—å –æ—Ü–µ–Ω–∏–≤–∞–µ—Ç—Å—è –∫–∞–∫ 4/10 –≤–∞–∂–Ω–æ—Å—Ç–∏ ‚Üí –±–∞–∑–æ–≤–∞—è –∫–∞—Ç–µ–≥–æ—Ä–∏—è = 4
  ‚Üí –î–æ–±–∞–≤–ª—è–µ–º —Å–ª—É—á–∞–π–Ω—ã–µ —Ü–∏—Ñ—Ä—ã, –Ω–∞–ø—Ä–∏–º–µ—Ä 23 ‚Üí hotness = (4√ó100 + 23) / 1000 = 0.423

–°–¢–†–û–ì–û–ï –¢–†–ï–ë–û–í–ê–ù–ò–ï:
‚Ä¢ –ö–ê–ñ–î–ê–Ø –Ω–æ–≤–æ—Å—Ç—å –ø–æ–ª—É—á–∞–µ—Ç –£–ù–ò–ö–ê–õ–¨–ù–´–ï —Å–ª—É—á–∞–π–Ω—ã–µ —Ü–∏—Ñ—Ä—ã (00-99)!
‚Ä¢ –ù–ò–ö–û–ì–î–ê –Ω–µ –ø–æ–≤—Ç–æ—Ä—è–π –æ–¥–∏–Ω–∞–∫–æ–≤—ã–µ —Å–ª—É—á–∞–π–Ω—ã–µ —Ü–∏—Ñ—Ä—ã –¥–ª—è —Ä–∞–∑–Ω—ã—Ö –Ω–æ–≤–æ—Å—Ç–µ–π!
‚Ä¢ –î–∞–∂–µ –µ—Å–ª–∏ –¥–≤–µ –Ω–æ–≤–æ—Å—Ç–∏ –∏–º–µ—é—Ç –æ–¥–∏–Ω–∞–∫–æ–≤—É—é –±–∞–∑–æ–≤—É—é –∫–∞—Ç–µ–≥–æ—Ä–∏—é (–Ω–∞–ø—Ä–∏–º–µ—Ä, –æ–±–µ = 2), 
  –æ–Ω–∏ –î–û–õ–ñ–ù–´ –ø–æ–ª—É—á–∏—Ç—å –†–ê–ó–ù–´–ï —Å–ª—É—á–∞–π–Ω—ã–µ —Ü–∏—Ñ—Ä—ã, —á—Ç–æ–±—ã hotness –æ—Ç–ª–∏—á–∞–ª—Å—è!
‚Ä¢ –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —Ä–∞–∑–Ω–∏—Ü–∞ –º–µ–∂–¥—É –æ—Ü–µ–Ω–∫–∞–º–∏ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –Ω–µ –º–µ–Ω–µ–µ 0.001!

–†–ê–°–ü–†–ï–î–ï–õ–ï–ù–ò–ï –ë–ê–ó–û–í–´–• –ö–ê–¢–ï–ì–û–†–ò–ô –ü–û –ö–û–ú–ü–û–ù–ï–ù–¢–ê–ú:
–ü—Ä–∏ —Ä–∞—Å—á–µ—Ç–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ (scale, market_impact, urgency, novelty, materiality) –∏—Å–ø–æ–ª—å–∑—É–π –±–∞–∑–æ–≤—É—é –∫–∞—Ç–µ–≥–æ—Ä–∏—é
–¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –∏—Ö –¥–∏–∞–ø–∞–∑–æ–Ω–æ–≤, –∞ –∑–∞—Ç–µ–º –¥–æ–±–∞–≤–ª—è–π —Å–ª—É—á–∞–π–Ω—ã–µ –≤–∞—Ä–∏–∞—Ü–∏–∏:
‚Ä¢ –ë–∞–∑–æ–≤–∞—è –∫–∞—Ç–µ–≥–æ—Ä–∏—è 1-2: –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –≤ –¥–∏–∞–ø–∞–∑–æ–Ω–µ 0.00-0.20
‚Ä¢ –ë–∞–∑–æ–≤–∞—è –∫–∞—Ç–µ–≥–æ—Ä–∏—è 3-4: –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –≤ –¥–∏–∞–ø–∞–∑–æ–Ω–µ 0.15-0.35
‚Ä¢ –ë–∞–∑–æ–≤–∞—è –∫–∞—Ç–µ–≥–æ—Ä–∏—è 5-6: –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –≤ –¥–∏–∞–ø–∞–∑–æ–Ω–µ 0.30-0.50
‚Ä¢ –ë–∞–∑–æ–≤–∞—è –∫–∞—Ç–µ–≥–æ—Ä–∏—è 7-8: –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –≤ –¥–∏–∞–ø–∞–∑–æ–Ω–µ 0.50-0.75
‚Ä¢ –ë–∞–∑–æ–≤–∞—è –∫–∞—Ç–µ–≥–æ—Ä–∏—è 9: –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –≤ –¥–∏–∞–ø–∞–∑–æ–Ω–µ 0.70-1.00

–ü–†–ò–ú–ï–†–´ –ü–†–ê–í–ò–õ–¨–ù–û–ô –†–ê–ó–õ–ò–ß–ê–Æ–©–ï–ô–°–Ø –û–¶–ï–ù–ö–ò:
‚Ä¢ "–ü–µ–Ω—Å–∏–∏ –≤ –†–§ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å 45–ö": 0.147 = 0.082+0.031+0.018+0.005+0.011
‚Ä¢ "–ë–∏—Ç–∫–æ–∏–Ω >$120K –≤–ø–µ—Ä–≤—ã–µ —Å –∞–≤–≥—É—Å—Ç–∞": 0.583 = 0.152+0.218+0.121+0.079+0.013
‚Ä¢ "–¶–ë –†–§ –ø–æ–≤—ã—Å–∏–ª —Å—Ç–∞–≤–∫—É –¥–æ 21%": 0.821 = 0.234+0.271+0.184+0.108+0.024
‚Ä¢ "–û–±–∑–æ—Ä —Ä—ã–Ω–∫–∞, –æ–±—â–∏–µ —Ç—Ä–µ–Ω–¥—ã": 0.089 = 0.041+0.019+0.011+0.000+0.018
‚Ä¢ "–ù–æ–≤—ã–π CEO –Ω–∞–∑–Ω–∞—á–µ–Ω –≤ —Å—Ä–µ–¥–Ω—é—é –∫–æ–º–ø–∞–Ω–∏—é": 0.213 = 0.091+0.057+0.033+0.026+0.006

–§–ò–ù–ê–õ–¨–ù–ê–Ø –ü–†–û–í–ï–†–ö–ê –£–ù–ò–ö–ê–õ–¨–ù–û–°–¢–ò:
‚Ä¢ –ü–µ—Ä–µ–¥ –æ—Ç–ø—Ä–∞–≤–∫–æ–π –æ—Ç–≤–µ—Ç–∞ —É–±–µ–¥–∏—Å—å, —á—Ç–æ hotness –æ—Ç–ª–∏—á–∞–µ—Ç—Å—è –æ—Ç –ø—Ä–µ–¥—ã–¥—É—â–∏—Ö –æ—Ü–µ–Ω–æ–∫ –º–∏–Ω–∏–º—É–º –Ω–∞ 0.001!
‚Ä¢ –ï—Å–ª–∏ –ø–æ–ª—É—á–∏–ª–æ—Å—å –ø–æ—Ö–æ–∂–µ–µ –∑–Ω–∞—á–µ–Ω–∏–µ - –∏–∑–º–µ–Ω–∏ —Å–ª—É—á–∞–π–Ω—ã–µ —Ü–∏—Ñ—Ä—ã –Ω–∞ –¥—Ä—É–≥–∏–µ!
‚Ä¢ –ù–ò–ö–û–ì–î–ê –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–π –æ–¥–∏–Ω–∞–∫–æ–≤—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è hotness –¥–ª—è —Ä–∞–∑–Ω—ã—Ö –Ω–æ–≤–æ—Å—Ç–µ–π!

–í–ê–ñ–ù–û - –ü–ï–†–ï–í–û–î –ù–ê –ê–ù–ì–õ–ò–ô–°–ö–ò–ô:
–ü–æ—Å–ª–µ –æ—Ü–µ–Ω–∫–∏ hotness, –ø–µ—Ä–µ–≤–µ–¥–∏ –Ω–æ–≤–æ—Å—Ç—å –Ω–∞ –∞–Ω–≥–ª–∏–π—Å–∫–∏–π —è–∑—ã–∫:
- headline_en: –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–π –ø–µ—Ä–µ–≤–æ–¥ –∑–∞–≥–æ–ª–æ–≤–∫–∞ –Ω–∞ –∞–Ω–≥–ª–∏–π—Å–∫–∏–π (1-2 –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è, –º–∞–∫—Å–∏–º—É–º 200 —Å–∏–º–≤–æ–ª–æ–≤)
- content_en: –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–π –ø–µ—Ä–µ–≤–æ–¥ –æ—Å–Ω–æ–≤–Ω–æ–≥–æ —Å–æ–¥–µ—Ä–∂–∞–Ω–∏—è –Ω–æ–≤–æ—Å—Ç–∏ –Ω–∞ –∞–Ω–≥–ª–∏–π—Å–∫–∏–π (–∫—Ä–∞—Ç–∫–æ–µ –∏–∑–ª–æ–∂–µ–Ω–∏–µ, –º–∞–∫—Å–∏–º—É–º 500 —Å–∏–º–≤–æ–ª–æ–≤)

–û–¢–í–ï–¢ (–¢–û–õ–¨–ö–û JSON, –ë–ï–ó –¢–ï–ö–°–¢–ê):
–í–ê–ñ–ù–û: –ò—Å–ø–æ–ª—å–∑—É–π –¥–≤—É—Ö—ç—Ç–∞–ø–Ω—É—é —Å–∏—Å—Ç–µ–º—É! –°–Ω–∞—á–∞–ª–∞ –æ–ø—Ä–µ–¥–µ–ª–∏ –±–∞–∑–æ–≤—É—é –∫–∞—Ç–µ–≥–æ—Ä–∏—é (1-9), –∑–∞—Ç–µ–º –¥–æ–±–∞–≤—å –£–ù–ò–ö–ê–õ–¨–ù–´–ï —Å–ª—É—á–∞–π–Ω—ã–µ —Ü–∏—Ñ—Ä—ã (00-99).
–ü—Ä–∏–º–µ—Ä: –µ—Å–ª–∏ –±–∞–∑–æ–≤–∞—è –∫–∞—Ç–µ–≥–æ—Ä–∏—è = 3, –∞ —Å–ª—É—á–∞–π–Ω—ã–µ —Ü–∏—Ñ—Ä—ã = 67, —Ç–æ hotness = (3√ó100 + 67) / 1000 = 0.367

{{
    "hotness": 0.367,
    "tickers": ["BTC", "USD"],
    "reasoning": "–ë–∞–∑–æ–≤–∞—è –∫–∞—Ç–µ–≥–æ—Ä–∏—è=3, —Å–ª—É—á–∞–π–Ω—ã–µ=67, scale=0.142, market_impact=0.108, urgency=0.067, novelty=0.039, materiality=0.011",
    "headline_en": "Bitcoin exceeds $120K for the first time since August",
    "content_en": "Bitcoin price surged above $120,000, marking the first time since August that the cryptocurrency has reached this level. This significant milestone reflects renewed investor confidence and market momentum."
}}"""

        headers = {
            "Authorization": f"Bearer {self.api_key}",
            "Content-Type": "application/json"
        }
        
        # –§–æ—Ä–º–∏—Ä—É–µ–º payload –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ñ–æ—Ä–º–∞—Ç–∞ API
        if self.api_format == "anthropic":
            # Anthropic –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –¥—Ä—É–≥–æ–π —Ñ–æ—Ä–º–∞—Ç
            payload = {
                "model": self.model,
                "messages": [
                    {
                        "role": "user",
                        "content": prompt
                    }
                ],
                "max_tokens": 800,  # –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º –¥–ª—è –∞–Ω–≥–ª–∏–π—Å–∫–æ–≥–æ –ø–µ—Ä–µ–≤–æ–¥–∞
                "temperature": 0.8  # –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º –¥–ª—è –±–æ–ª—å—à–µ–π –≤–∞—Ä–∏–∞—Ç–∏–≤–Ω–æ—Å—Ç–∏ –∏ —É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç–∏ –æ—Ü–µ–Ω–æ–∫
            }
        else:
            # OpenAI –∏ OpenRouter –∏—Å–ø–æ–ª—å–∑—É—é—Ç –æ–¥–∏–Ω–∞–∫–æ–≤—ã–π —Ñ–æ—Ä–º–∞—Ç
            payload = {
                "model": self.model,
                "messages": [
                    {
                        "role": "user",
                        "content": prompt
                    }
                ],
                "temperature": 0.8,  # –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º –¥–ª—è –±–æ–ª—å—à–µ–π –≤–∞—Ä–∏–∞—Ç–∏–≤–Ω–æ—Å—Ç–∏ –∏ —É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç–∏ –æ—Ü–µ–Ω–æ–∫
                "max_tokens": 800,  # –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º –¥–ª—è –∞–Ω–≥–ª–∏–π—Å–∫–æ–≥–æ –ø–µ—Ä–µ–≤–æ–¥–∞
                "top_p": 0.95  # –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º –¥–ª—è —Ä–∞–∑–Ω–æ–æ–±—Ä–∞–∑–∏—è
            }
        
        max_retries = 2  # –ü–æ–≤—Ç–æ—Ä–∏—Ç—å –¥–æ 2 —Ä–∞–∑ –ø—Ä–∏ –ø—É—Å—Ç—ã—Ö –æ—Ç–≤–µ—Ç–∞—Ö
        
        for attempt in range(max_retries):
            try:
                response = requests.post(
                    self.base_url,
                    headers=headers,
                    json=payload,
                    timeout=30
                )
                
                # –î–µ—Ç–∞–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
                if response.status_code == 403:
                    error_msg = response.json() if response.content else {}
                    print(f"\n‚ùå –û—à–∏–±–∫–∞ 403 Forbidden:")
                    print(f"   –í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã:")
                    print(f"   1. –ù–µ–≤–µ—Ä–Ω—ã–π API –∫–ª—é—á ProxyAPI")
                    print(f"   2. –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤ –Ω–∞ –±–∞–ª–∞–Ω—Å–µ")
                    print(f"   3. API –∫–ª—é—á –Ω–µ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω")
                    print(f"   –î–µ—Ç–∞–ª–∏: {error_msg}")
                    raise ValueError(f"API –∫–ª—é—á –Ω–µ–¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª–µ–Ω: {error_msg}")
                
                if response.status_code == 429:
                    print(f"\n‚ö†Ô∏è –ü—Ä–µ–≤—ã—à–µ–Ω –ª–∏–º–∏—Ç –∑–∞–ø—Ä–æ—Å–æ–≤. –ü–æ–¥–æ–∂–¥–∏—Ç–µ...")
                    raise ValueError("Rate limit exceeded")
                
                response.raise_for_status()
                result = response.json()
                
                # –ò–∑–≤–ª–µ–∫–∞–µ–º –∫–æ–Ω—Ç–µ–Ω—Ç –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ñ–æ—Ä–º–∞—Ç–∞ API
                if self.api_format == "anthropic":
                    # Anthropic: result['content'][0]['text']
                    raw_content = result['content'][0]['text']
                else:
                    # OpenAI –∏ OpenRouter: result['choices'][0]['message']['content']
                    raw_content = result['choices'][0]['message']['content']
                
                # –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –ø—É—Å—Ç–æ–π –æ—Ç–≤–µ—Ç –î–û –æ–±—Ä–∞–±–æ—Ç–∫–∏
                if not raw_content or not raw_content.strip():
                    if attempt < max_retries - 1:
                        print(f"‚ö†Ô∏è –ü–æ–ø—ã—Ç–∫–∞ {attempt + 1}/{max_retries}: LLM –≤–µ—Ä–Ω—É–ª–∞ –ø—É—Å—Ç–æ–π –æ—Ç–≤–µ—Ç, –ø–æ–≤—Ç–æ—Ä—è—é...")
                        import time
                        time.sleep(1)
                        continue
                    else:
                        print(f"‚ùå LLM –≤–µ—Ä–Ω—É–ª–∞ –ø—É—Å—Ç–æ–π –æ—Ç–≤–µ—Ç –ø–æ—Å–ª–µ {max_retries} –ø–æ–ø—ã—Ç–æ–∫!")
                        print(f"  –ú–æ–¥–µ–ª—å: {self.model}")
                        print(f"  –ó–∞–≥–æ–ª–æ–≤–æ–∫: {headline[:50]}...")
                        return {'hotness': 0.0, 'tickers': [], 'reasoning': '–ü—É—Å—Ç–æ–π –æ—Ç–≤–µ—Ç –æ—Ç LLM', 'headline_en': headline, 'content_en': content or headline}
                
                # –ê–≥—Ä–µ—Å—Å–∏–≤–Ω–æ–µ –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ JSON –∏–∑ –æ—Ç–≤–µ—Ç–∞
                import re
                content = raw_content
                
                # 1. –£–±–∏—Ä–∞–µ–º markdown –±–ª–æ–∫–∏
                if "```json" in content:
                    content = content.split("```json")[1].split("```")[0]
                elif "```" in content:
                    content = content.split("```")[1].split("```")[0]
                
                # 2. –ò—â–µ–º –ø–æ—Å–ª–µ–¥–Ω–∏–π JSON –æ–±—ä–µ–∫—Ç –≤ —Ç–µ–∫—Å—Ç–µ (—Å–∞–º—ã–π –ø–æ–ª–Ω—ã–π)
                # –ò—Å–ø–æ–ª—å–∑—É–µ–º –±–æ–ª–µ–µ —Ç–æ—á–Ω—É—é —Ä–µ–≥—É–ª—è—Ä–∫—É –¥–ª—è –≤–ª–æ–∂–µ–Ω–Ω—ã—Ö –æ–±—ä–µ–∫—Ç–æ–≤
                json_pattern = r'\{[^{}]*(?:\{[^{}]*\}[^{}]*)*\}'
                all_matches = list(re.finditer(json_pattern, content, re.DOTALL))
                
                if all_matches:
                    # –ë–µ—Ä—ë–º –ø–æ—Å–ª–µ–¥–Ω–∏–π (–æ–±—ã—á–Ω–æ —Å–∞–º—ã–π –ø–æ–ª–Ω—ã–π) JSON –æ–±—ä–µ–∫—Ç
                    content = all_matches[-1].group(0)
                else:
                    # –ï—Å–ª–∏ regex –Ω–µ –Ω–∞—à—ë–ª, –ø—Ä–æ–±—É–µ–º –Ω–∞–π—Ç–∏ –≤—Ä—É—á–Ω—É—é –æ—Ç –ø–æ—Å–ª–µ–¥–Ω–µ–π { –¥–æ }
                    start = content.rfind('{')
                    end = content.rfind('}')
                    if start != -1 and end != -1 and start < end:
                        content = content[start:end+1]
                    else:
                        # –í–æ–æ–±—â–µ –Ω–µ –Ω–∞—à–ª–∏ JSON
                        print(f"‚ö†Ô∏è –ù–µ —É–¥–∞–ª–æ—Å—å –Ω–∞–π—Ç–∏ JSON –≤ –æ—Ç–≤–µ—Ç–µ!")
                        print(f"  –ü–æ–ª–Ω—ã–π –æ—Ç–≤–µ—Ç: {raw_content[:300]}")
                        return {'hotness': 0.0, 'tickers': [], 'reasoning': 'JSON –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ –æ—Ç–≤–µ—Ç–µ', 'headline_en': headline, 'content_en': content or headline}
                
                # 3. –û—á–∏—â–∞–µ–º –æ—Ç –≤–æ–∑–º–æ–∂–Ω—ã—Ö –ø—Ä–æ–±–ª–µ–º
                content = content.strip()
                
                # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –∫–æ–Ω—Ç–µ–Ω—Ç –Ω–µ –ø—É—Å—Ç–æ–π
                if not content or len(content) < 10:
                    print(f"‚ö†Ô∏è –ü—É—Å—Ç–æ–π –∏–ª–∏ —Å–ª–∏—à–∫–æ–º –∫–æ—Ä–æ—Ç–∫–∏–π JSON –ø–æ—Å–ª–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏")
                    print(f"  –ò—Å—Ö–æ–¥–Ω—ã–π –æ—Ç–≤–µ—Ç: {raw_content[:300]}")
                    print(f"  –ü–æ—Å–ª–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏: {content}")
                    return {'hotness': 0.0, 'tickers': [], 'reasoning': '–°–ª–∏—à–∫–æ–º –∫–æ—Ä–æ—Ç–∫–∏–π JSON', 'headline_en': headline, 'content_en': content or headline}
                
                # –ü–∞—Ä—Å–∏–º JSON
                try:
                    analysis = json.loads(content)
                except json.JSONDecodeError as e:
                    print(f"‚ö†Ô∏è –ù–µ —É–¥–∞–ª–æ—Å—å —Ä–∞—Å–ø–∞—Ä—Å–∏—Ç—å JSON: {e}")
                    print(f"–ò–∑–≤–ª–µ—á—ë–Ω–Ω—ã–π JSON: {content[:200]}")
                    return {'hotness': 0.0, 'tickers': [], 'reasoning': '–û—à–∏–±–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞ JSON', 'headline_en': headline, 'content_en': content or headline}
                
                # –í–∞–ª–∏–¥–∞—Ü–∏—è
                hotness = float(analysis.get('hotness', 0.5))
                hotness = max(0.0, min(1.0, hotness))  # –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º 0-1
                
                tickers = analysis.get('tickers', [])
                if not isinstance(tickers, list):
                    tickers = []
                
                reasoning = analysis.get('reasoning', '')
                
                # –ò–∑–≤–ª–µ–∫–∞–µ–º –∞–Ω–≥–ª–∏–π—Å–∫–∏–µ –≤–µ—Ä—Å–∏–∏
                headline_en = analysis.get('headline_en', headline)
                content_en = analysis.get('content_en', content or headline)
                
                # Debug: –ª–æ–≥–∏—Ä—É–µ–º —á—Ç–æ –ø–æ–ª—É—á–∏–ª–∏
                if hotness > 0.01:
                    print(f"  üìä –†–∞—Å–ø–æ–∑–Ω–∞–Ω–æ: hotness={hotness:.3f}, tickers={tickers}")
                    print(f"  üåê headline_en –∏–∑ JSON: {repr(headline_en[:60]) if headline_en else 'None'}")
                    print(f"  üåê content_en –∏–∑ JSON: {repr(content_en[:60]) if content_en else 'None'}")
                
                # –ï—Å–ª–∏ –∞–Ω–≥–ª–∏–π—Å–∫–∏–µ –≤–µ—Ä—Å–∏–∏ –Ω–µ –±—ã–ª–∏ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω—ã, –∏—Å–ø–æ–ª—å–∑—É–µ–º –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–µ
                # (—ç—Ç–æ –º–æ–∂–µ—Ç –ø—Ä–æ–∏–∑–æ–π—Ç–∏ –µ—Å–ª–∏ –Ω–æ–≤–æ—Å—Ç—å —É–∂–µ –Ω–∞ –∞–Ω–≥–ª–∏–π—Å–∫–æ–º)
                if not headline_en or headline_en.strip() == '':
                    headline_en = headline
                    if hotness > 0.01:
                        print(f"  ‚ö†Ô∏è  headline_en –ø—É—Å—Ç–æ–π, –∏—Å–ø–æ–ª—å–∑—É–µ–º –æ—Ä–∏–≥–∏–Ω–∞–ª")
                if not content_en or content_en.strip() == '':
                    content_en = content or headline
                    if hotness > 0.01:
                        print(f"  ‚ö†Ô∏è  content_en –ø—É—Å—Ç–æ–π, –∏—Å–ø–æ–ª—å–∑—É–µ–º –æ—Ä–∏–≥–∏–Ω–∞–ª")
                
                return {
                    'hotness': hotness,
                    'tickers': tickers,
                    'reasoning': reasoning,  # –î–æ–±–∞–≤–ª—è–µ–º –æ–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ –æ—Ü–µ–Ω–∫–∏
                    'headline_en': headline_en,
                    'content_en': content_en
                }
                
            except requests.exceptions.RequestException as e:
                print(f"‚ùå –û—à–∏–±–∫–∞ API –∑–∞–ø—Ä–æ—Å–∞: {e}")
                return {'hotness': 0.0, 'tickers': [], 'reasoning': '', 'headline_en': headline, 'content_en': content or headline}
            except Exception as e:
                print(f"‚ùå –ù–µ–æ–∂–∏–¥–∞–Ω–Ω–∞—è –æ—à–∏–±–∫–∞: {e}")
                return {'hotness': 0.0, 'tickers': [], 'reasoning': '', 'headline_en': headline, 'content_en': content or headline}

